<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>James Theakston - AI Capabilities</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff; /* Consistent with main page */
            color: #334155; /* Darker text color for readability */
        }
        /* Custom styles for menu toggle */
        @media (max-width: 767px) {
            .mobile-menu-hidden {
                display: none;
            }
        }
        /* Basic modal styling for messages */
        .message-modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .message-modal-content {
            background-color: #fefefe;
            padding: 30px;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-lg */
            width: 90%;
            max-width: 400px;
            text-align: center;
            position: relative;
        }
        .message-modal-close-button {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .message-modal-close-button:hover,
        .message-modal-close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body class="antialiased">
    <!-- Header Section with Navigation -->
    <header class="bg-gradient-to-r from-blue-700 to-indigo-800 text-white py-4 px-4 sm:px-6 lg:px-8 shadow-xl rounded-b-2xl">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <h1 class="text-3xl font-extrabold tracking-tight">
                <a href="index.html" class="hover:text-gray-100 transition duration-300">James Theakston</a>
            </h1>

            <!-- Mobile menu button -->
            <button id="menu-button" class="md:hidden text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-white rounded-md p-2" aria-label="Toggle navigation menu">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>

            <!-- Navigation Menu -->
            <nav id="main-nav" class="mobile-menu-hidden md:block">
                <ul class="flex flex-col md:flex-row md:space-x-8 mt-4 md:mt-0 items-center">
                    <li><a href="about.html" class="block py-2 px-4 hover:bg-blue-800 rounded-lg transition duration-300 font-medium">About</a></li>
                    <li><a href="ai.html" class="block py-2 px-4 bg-blue-800 rounded-lg font-medium">AI</a></li> <!-- Active link -->
                    <li><a href="index.html#projects" class="block py-2 px-4 hover:bg-blue-800 rounded-lg transition duration-300 font-medium">Projects</a></li>
                    <li><a href="index.html#contact" class="block py-2 px-4 hover:bg-blue-800 rounded-lg transition duration-300 font-medium">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content for AI Capabilities -->
    <section id="ai-capabilities-content" class="py-20 px-4 sm:px-6 lg:px-8 bg-white shadow-lg rounded-xl mx-auto max-w-5xl mt-8 mb-8">
        <div class="max-w-4xl mx-auto">
            <h2 class="text-5xl font-extrabold text-gray-900 mb-12 text-center leading-tight">Explore AI Capabilities</h2>

            <!-- AI Text Generator Section -->
            <div class="bg-gray-50 p-8 rounded-2xl shadow-md border border-gray-200 mb-12">
                <h3 class="text-3xl font-bold text-gray-800 mb-6 text-center">✨ AI Text Generator</h3>
                <div class="space-y-6">
                    <div>
                        <label for="textPrompt" class="block text-lg font-medium text-gray-700 mb-2">Enter your prompt:</label>
                        <textarea id="textPrompt" rows="4" class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 text-lg" placeholder="e.g., Write a short story about a brave knight."></textarea>
                    </div>
                    <div class="text-center">
                        <button id="generateTextBtn" class="inline-flex items-center px-8 py-3 border border-transparent text-lg font-medium rounded-lg shadow-sm text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition duration-300">
                            Generate Text
                        </button>
                    </div>
                    <div id="textLoading" class="hidden text-center text-blue-600 font-medium">Generating text...</div>
                    <div id="textOutput" class="mt-6 p-4 bg-purple-50 rounded-lg text-left text-gray-800 text-lg leading-relaxed whitespace-pre-wrap hidden"></div>
                </div>
            </div>

            <!-- AI Image Generator Section -->
            <div class="bg-gray-50 p-8 rounded-2xl shadow-md border border-gray-200">
                <h3 class="text-3xl font-bold text-gray-800 mb-6 text-center">✨ AI Image Generator</h3>
                <div class="space-y-6">
                    <div>
                        <label for="imagePrompt" class="block text-lg font-medium text-gray-700 mb-2">Describe the image you want to generate:</label>
                        <input type="text" id="imagePrompt" class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 text-lg" placeholder="e.g., A futuristic city at sunset with flying cars.">
                    </div>
                    <div class="text-center">
                        <button id="generateImageBtn" class="inline-flex items-center px-8 py-3 border border-transparent text-lg font-medium rounded-lg shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-300">
                            Generate Image
                        </button>
                    </div>
                    <div id="imageLoading" class="hidden text-center text-blue-600 font-medium">Generating image...</div>
                    <div id="imageOutput" class="mt-6 text-center hidden">
                        <img id="generatedImage" src="" alt="Generated Image" class="max-w-full h-auto rounded-lg shadow-md mx-auto">
                    </div>
                </div>
            </div>

        </div>
    </section>

    <!-- Footer Section -->
    <footer class="bg-gray-900 text-white py-10 px-4 sm:px-6 lg:px-8 rounded-t-2xl">
        <div class="max-w-5xl mx-auto text-center text-gray-400 text-lg">
            <p>&copy; 2025 James Theakston. All rights reserved.</p>
            <p class="mt-3">Designed with <span class="text-red-500">&hearts;</span> and built with Tailwind CSS and Google Gemini.</p>
        </div>
    </footer>

    <!-- Message Modal -->
    <div id="messageModal" class="message-modal">
        <div class="message-modal-content">
            <span class="message-modal-close-button" id="closeMessageModalBtn">&times;</span>
            <p id="modalMessageText" class="text-lg font-semibold"></p>
        </div>
    </div>

    <script type="module">
        // Get references to the menu button and the navigation menu
        const menuButton = document.getElementById('menu-button');
        const mainNav = document.getElementById('main-nav');

        // Add click event listener to the menu button
        menuButton.addEventListener('click', () => {
            // Toggle the 'mobile-menu-hidden' class to show/hide the menu
            mainNav.classList.toggle('mobile-menu-hidden');
        });

        // Close the menu when a navigation link is clicked (for mobile)
        const navLinks = mainNav.querySelectorAll('a');
        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                if (!mainNav.classList.contains('md:block')) { // Only hide if it's the mobile menu
                    mainNav.classList.add('mobile-menu-hidden');
                }
            });
        });

        // --- Message Modal Logic ---
        const messageModal = document.getElementById('messageModal');
        const modalMessageText = document.getElementById('modalMessageText');
        const closeMessageModalBtn = document.getElementById('closeMessageModalBtn');

        function showCustomModal(message) {
            modalMessageText.textContent = message;
            messageModal.style.display = 'flex';
        }

        closeMessageModalBtn.onclick = function() {
            messageModal.style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target == messageModal) {
                messageModal.style.display = 'none';
            }
        }

        // --- AI Text Generator Logic ---
        const textPromptInput = document.getElementById('textPrompt');
        const generateTextBtn = document.getElementById('generateTextBtn');
        const textLoading = document.getElementById('textLoading');
        const textOutput = document.getElementById('textOutput');

        generateTextBtn.addEventListener('click', async () => {
            const prompt = textPromptInput.value.trim();
            if (!prompt) {
                showCustomModal('Please enter a prompt for text generation.');
                return;
            }

            textLoading.classList.remove('hidden');
            textOutput.classList.add('hidden');
            textOutput.textContent = ''; // Clear previous output

            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; // Canvas will provide this at runtime
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                // Improved error handling for non-ok responses
                if (!response.ok) {
                    let errorDetails = `HTTP error! Status: ${response.status}`;
                    try {
                        const errorBody = await response.text();
                        errorDetails += ` Body: ${errorBody.substring(0, 200)}...`; // Limit body length for message
                    } catch (e) {
                        // Ignore if reading body fails
                    }
                    throw new Error(errorDetails);
                }

                // Check content type before parsing as JSON
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const responseText = await response.text();
                    throw new Error(`Unexpected response format. Expected JSON, got: ${contentType || 'no content type'}. Body: ${responseText.substring(0, 200)}...`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const generatedText = result.candidates[0].content.parts[0].text;
                    textOutput.textContent = generatedText;
                    textOutput.classList.remove('hidden');
                } else {
                    showCustomModal("Could not generate text. The API response was unexpected or empty.");
                    console.error("Unexpected API response structure for text generation:", result);
                }
            } catch (error) {
                console.error("Error generating text:", error);
                showCustomModal(`Failed to generate text: ${error.message}`);
            } finally {
                textLoading.classList.add('hidden');
            }
        });

        // --- AI Image Generator Logic ---
        const imagePromptInput = document.getElementById('imagePrompt');
        const generateImageBtn = document.getElementById('generateImageBtn');
        const imageLoading = document.getElementById('imageLoading');
        const imageOutput = document.getElementById('imageOutput');
        const generatedImage = document.getElementById('generatedImage');

        generateImageBtn.addEventListener('click', async () => {
            const prompt = imagePromptInput.value.trim();
            if (!prompt) {
                showCustomModal('Please enter a prompt for image generation.');
                return;
            }

            imageLoading.classList.remove('hidden');
            imageOutput.classList.add('hidden');
            generatedImage.src = ''; // Clear previous image

            try {
                const payload = { instances: { prompt: prompt }, parameters: { "sampleCount": 1} };
                const apiKey = ""; // Canvas will provide this at runtime
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                // Improved error handling for non-ok responses
                if (!response.ok) {
                    let errorDetails = `HTTP error! Status: ${response.status}`;
                    try {
                        const errorBody = await response.text();
                        errorDetails += ` Body: ${errorBody.substring(0, 200)}...`; // Limit body length for message
                    } catch (e) {
                        // Ignore if reading body fails
                    }
                    throw new Error(errorDetails);
                }

                // Check content type before parsing as JSON
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const responseText = await response.text();
                    throw new Error(`Unexpected response format. Expected JSON, got: ${contentType || 'no content type'}. Body: ${responseText.substring(0, 200)}...`);
                }

                const result = await response.json();

                if (result.predictions && result.predictions.length > 0 && result.predictions[0].bytesBase64Encoded) {
                    const imageUrl = `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                    generatedImage.src = imageUrl;
                    imageOutput.classList.remove('hidden');
                } else {
                    showCustomModal("Could not generate image. The API response was unexpected or empty.");
                    console.error("Unexpected API response structure for image generation:", result);
                }
            } catch (error) {
                console.error("Error generating image:", error);
                showCustomModal(`Failed to generate image: ${error.message}`);
            } finally {
                imageLoading.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
